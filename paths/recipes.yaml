/recipes:
  get:
    tags:
       - recipes
    summary: Lists all Recipes which are available in the specified Workspace Id
    description: You need workspace memberships to access this resource
    parameters:
      - $ref: '../components/parameters/system-params.yaml#/page-size'
      - $ref: '../components/parameters/system-params.yaml#/page-number'
      - $ref: '../components/parameters/system-params.yaml#/workspace_id'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOutAll'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
  post:
    tags:
      - recipes
    summary: Creates a Recipe
    description: |
      You need `workspaces.recipe.edit` permission to access this resource

      When you create a Recipe, it has default visibility `workspace`
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/recipe-sch.yaml#/recipeIn'
    responses:
      '201':
        description: Created
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOut'
      '400':
        description: Bad Request
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/400'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
/recipes/{recipe_id}:
  get:
    tags:
      - recipes
    summary: Returns the Recipe based on the specified Recipe Id
    description: You need workspace memberships to access this resource
    parameters:
      - $ref: '../components/parameters/recipe-params.yaml#/recipe_id'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOut'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
      '404':
        description: Not Found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/404'
  patch:
    tags:
      - recipes
    summary: Update the Recipe based on the specified Recipe Id
    description: You need `workspaces.recipe.edit` permission to access this resource
    parameters:
      - $ref: '../components/parameters/recipe-params.yaml#/recipe_id'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/recipe-sch.yaml#/recipePatchIn'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOut'
      '400':
        description: Bad Request
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/400'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
      '404':
        description: Not Found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/404'
      '409':
        description: Conflict
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/409'
  delete:
    tags:
      - recipes
    summary: Remove the Recipe based on the specified Recipe Id
    description: |
      You need `workspaces.recipe.edit` permission to access this resource

      *Note:* deleting Recipes with `contract`, `tenant` and `global` visibility is forbidden
    parameters:
      - $ref: '../components/parameters/recipe-params.yaml#/recipe_id'
    responses:
      '204':
        description: No Content
        content:
          application/json:
            schema:
              type: object
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
      '404':
        description: Not Found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/404'
/recipes/{recipe_id}/activate:
  post:
    tags:
      - recipes
    summary: Creates a Flow from a Recipe based on the specified Recipe Id
    description: |
      You need `workspaces.flow.edit` permission to access this resource

      If the Recipe contains a Component, which requires a Credential, it should be provided among the request payload.
    parameters:
      - $ref: '../components/parameters/recipe-params.yaml#/recipe_id'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/recipe-sch.yaml#/recipeActivateIn'
    responses:
      '201':
        description: Created
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeActivateOut'
      '400':
        description: Bad Request
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/400'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
/recipes/{recipe_id}/visibility:
  patch:
    tags:
      - recipes
    summary: Update a Recipe visibility based on the specified Recipe Id
    description: |
      Accessing and sharing recipes:

      The recipe has an attribute ``visibility``, which indicates how the recipe is shared by other clients. A shared recipe
      is available to other users for their Flows. There are four sharing modes:

      - ``workspace`` – Only Workspace members can use the recipe.
      - ``contract`` – Members of all Contract Workspaces can use the recipe.
      - ``tenant`` – Recipe is available to other clients in the tenant.
      - ``global`` – Any user of the platform can use these recipes.

      Accordingly, a set of recipes available for each user consists of: non-shared recipes from the user's Workspace,
      recipes with `contract`, `tenant` and `global` access. When you create a recipe, it has default visibility `workspace`.

      You can upgrade or downgrade recipe visibility.

      This request is authorized depend on specified visibility level for a user that has next permission:
      - to `tenant` if user has permission `tenant.recipe.edit_visibility_tenant`
      - to `global` if user has permission `global.recipe.edit_visibility_global`
      - to `contract` if user has permission `workspaces.recipe.edit`
      - to `workspace` if user has permission `workspaces.recipe.edit`

    parameters:
      - $ref: '../components/parameters/recipe-params.yaml#/recipe_id'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/recipe-sch.yaml#/recipeVisibilityIn'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOut'
      '400':
        description: Bad Request
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/400'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
      '404':
        description: Not Found
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/404'
/flows/{flow_id}/export-to-recipe:
  post:
    tags:
      - recipes
      - flows
    summary: Creates a Recipe from existing Flow based on the specified Flow Id
    description: You need `workspaces.recipe.edit` and `workspaces.flow.exportToRecipe` permissions to access this resource
    parameters:
      - $ref: '../components/parameters/flow-params.yaml#/flow_id'
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../components/schemas/recipe-sch.yaml#/exportToRecipeIn'
    responses:
      '201':
        description: Created
        content:
          application/json:
            schema:
              $ref: '../components/schemas/recipe-sch.yaml#/recipeOut'
      '400':
        description: Bad Request
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/400'
      '401':
        description: Unauthorized
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/401'
      '403':
        description: Forbidden
        content:
          application/json:
            schema:
              $ref: '../components/schemas/errors-sch.yaml#/403'
